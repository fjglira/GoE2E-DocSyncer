package e2e_generated

import (
	"context"
	"os/exec"
	"time"

	. "github.com/onsi/ginkgo/v2"
	. "github.com/onsi/gomega"
)

// Auto-generated by docsyncer from: testdata/markdown/simple.md
// Source type: markdown
// DO NOT EDIT â€” this file is regenerated on every run.

var _ = Describe("Simple Deployment Guide", func() {
	Context("Deploy the Application", func() {

		It("Simple deployment test", func() {
			{
				By("Apply deployment manifests")
				dur, err := time.ParseDuration("30s")
				Expect(err).ToNot(HaveOccurred())
				ctx, cancel := context.WithTimeout(context.Background(), dur)
				defer cancel()
				cmd := exec.CommandContext(ctx, "kubectl", "apply", "-f", "./manifests/deployment.yaml")
				output, err := cmd.CombinedOutput()
				Expect(err).ToNot(HaveOccurred(), string(output))
			}
			{
				By("kubectl wait")
				dur, err := time.ParseDuration("60s")
				Expect(err).ToNot(HaveOccurred())
				ctx, cancel := context.WithTimeout(context.Background(), dur)
				defer cancel()
				cmd := exec.CommandContext(ctx, "kubectl", "wait", "--for=condition=ready", "pod", "-l", "app=myapp", "--timeout=120s")
				output, err := cmd.CombinedOutput()
				Expect(err).ToNot(HaveOccurred(), string(output))
			}
			{
				By("kubectl get")
				dur, err := time.ParseDuration("30s")
				Expect(err).ToNot(HaveOccurred())
				ctx, cancel := context.WithTimeout(context.Background(), dur)
				defer cancel()
				cmd := exec.CommandContext(ctx, "kubectl", "get", "svc", "myapp-service", "-o", "jsonpath={.spec.clusterIP}")
				output, err := cmd.CombinedOutput()
				Expect(err).ToNot(HaveOccurred(), string(output))
			}
		})
	})
})
