package e2e_generated

import (
	"context"
	"os/exec"
	"time"

	. "github.com/onsi/ginkgo/v2"
	. "github.com/onsi/gomega"
)

// Auto-generated by docsyncer from: testdata/plaintext/generic.txt
// Source type: plaintext
// DO NOT EDIT — this file is regenerated on every run.

var _ = Describe("Generic Text Document — E2E Test Steps", func() {
	Context("Setup Steps", func() {

		It("generic", func() {
			{
				By("Create test namespace")
				dur, err := time.ParseDuration("30s")
				Expect(err).ToNot(HaveOccurred())
				ctx, cancel := context.WithTimeout(context.Background(), dur)
				defer cancel()
				cmd := exec.CommandContext(ctx, "kubectl", "create", "namespace", "e2e-test")
				output, err := cmd.CombinedOutput()
				Expect(err).ToNot(HaveOccurred(), string(output))
			}
			{
				By("Deploy test fixtures")
				dur, err := time.ParseDuration("60s")
				Expect(err).ToNot(HaveOccurred())
				ctx, cancel := context.WithTimeout(context.Background(), dur)
				defer cancel()
				cmd := exec.CommandContext(ctx, "kubectl", "apply", "-f", "./testdata/fixtures/", "-n", "e2e-test")
				output, err := cmd.CombinedOutput()
				Expect(err).ToNot(HaveOccurred(), string(output))
			}
			{
				By("Verify pods are running")
				dur, err := time.ParseDuration("30s")
				Expect(err).ToNot(HaveOccurred())
				ctx, cancel := context.WithTimeout(context.Background(), dur)
				defer cancel()
				cmd := exec.CommandContext(ctx, "kubectl", "get", "pods", "-n", "e2e-test", "-o", "wide")
				output, err := cmd.CombinedOutput()
				Expect(err).ToNot(HaveOccurred(), string(output))
			}
			{
				By("Run smoke test")
				dur, err := time.ParseDuration("30s")
				Expect(err).ToNot(HaveOccurred())
				ctx, cancel := context.WithTimeout(context.Background(), dur)
				defer cancel()
				cmd := exec.CommandContext(ctx, "curl", "-f", "http://localhost:8080/api/v1/status")
				output, err := cmd.CombinedOutput()
				Expect(err).ToNot(HaveOccurred(), string(output))
			}
			{
				By("Cleanup test namespace")
				dur, err := time.ParseDuration("30s")
				Expect(err).ToNot(HaveOccurred())
				ctx, cancel := context.WithTimeout(context.Background(), dur)
				defer cancel()
				cmd := exec.CommandContext(ctx, "kubectl", "delete", "namespace", "e2e-test")
				output, err := cmd.CombinedOutput()
				Expect(err).ToNot(HaveOccurred(), string(output))
			}
		})
	})
})
